<?	//require_once('auth.class.php');		class cls_user {		var $table_name;		var $table_mail;		var $fields = array();			var $fields_empty = array();		var $fields_type = array();		var $flag = "update";function cls_user() {		$this->table_name = 'director_info';		$sql=mysql_query("SHOW COLUMNS FROM ".$this->table_name);		//$rows = mysql_num_rows($sql);		while($res=mysql_fetch_row($sql))		{			$name=$res[0];			$type=$res[1];			$this->fields_empty = array_merge($this->fields_empty,array($name=>''));			$this->fields = array_merge($this->fields,array($name));			$this->fields_type = array_merge($this->fields_type,array($name=>$type));		}		//print_r ($this->fields_type);			 		}function enum_select($table,$key,$val) 	{ 		$sql="SHOW COLUMNS FROM `$table` LIKE '$key'";		$result=mysql_query($sql); 		if(mysql_num_rows($result)>0)			{ 				$row=mysql_fetch_row($result); 				$options=explode("','", preg_replace("/(enum|set)\('(.+?)'\)/","\\2", $row[1])); 				$enum = array(); 				foreach ($options as $value) 					{					$enum = array_merge($enum,array($value));					} 			} 			echo '<tr><td>' . ucwords(str_replace('_', ' ', $key)) . '<font color="#FF0033">*</font></td><td><select name="'.$key.'" id="'.$key.'">';		for($i=0;$i<sizeof($enum);$i++)		{			if($val==$enum[$i])			echo '<option value="'.$enum[$i].'" selected>'.$enum[$i].'</option>';			else			echo '<option value="'.$enum[$i].'">'.$enum[$i].'</option>';		}		echo "  </select></td></tr>";	}function profile_image($id)	{		  echo '<table width="100%" border="0" cellspacing="0" cellpadding="0"><tr><td>';							if(is_file("../image/".$this->table_name."/".$id.".gif"))						$pic="../image/".$this->table_name."/".$id.".gif";						else						$pic="../image/".$this->table_name."/"."0.gif";			 echo '<img src="'.$pic.'" alt="Profile Picture" name="photo" width="200" height="250" id="photo" /></td></tr><tr><td>';		 echo '<input name="profile_pic" type="file" value="" id="profile_pic" onChange="getpic()"/></td></tr></table>';	}	function create_form($id){		$row        =$this->get_info($id);while (list($key, $value)=each($row))        {									if ($key != "uname"&&$key != "entry_date"&&$key != "entry_by" &&$key != "edit_date" )			{					if(substr($this->fields_type[$key],0,1)=='v')							{                            echo '<tr>    						<td>' . ucwords(str_replace('_', ' ', $key)) . '<font color="#FF0033">*</font></td>    						<td><input name="' . $key . '" type="' . ($key == 'password' ? 'password'                            : 'text') . '" class="myinput" value="' . $value . '" size="50"></td></tr>';							}					if(substr($this->fields_type[$key],0,1)=='i')							{                            echo '<tr><td>' . ucwords(str_replace('_', ' ', $key)) . '<font color="#FF0033">*</font></td>    						<td><input name="' . $key . '" type="text" class="myinput" value="' . $value . '" size="20"' . ($key == 'dir_id' ? 'disabled="disabled"' : '') . '></td></tr>';							}					if(substr($this->fields_type[$key],0,1)=='t')							{                            echo '<tr><td>' . ucwords(str_replace('_', ' ', $key)) . '<font color="#FF0033">*</font></td>    						<td><textarea name="' . $key . '" cols="50" rows="2" id="name" class="myinput" >' . $value . '</textarea>							</td></tr>';							}					if(substr($this->fields_type[$key],0,1)=='d')							{                            echo '<tr><td>' . ucwords(str_replace('_', ' ', $key)) . '<font color="#FF0033">*</font></td>';    						echo '<td><input name="' . $key . '" id="' . $key . '" type="text" class="myinput" value="';							if($value=='')							echo date("d-m-Y",time());							else							echo mysql_format2date($value);							echo '" size="20">';							echo '<script language="JavaScript" type="text/javascript">';							echo '$(function() {$("#'.$key.'").datepicker({dateFormat: "dd-mm-yy",changeMonth: true,changeYear: true});});';							echo '</script>';							echo '</td></tr>';							}					if(substr($this->fields_type[$key],0,1)=='e')							{                            $this->enum_select($this->table_name,$key,$value);							}										}		}}function foreign_relation($table,$value1,$show,$key,$value){$sql="select $value1,$show from $table";$res=mysql_query($sql);    echo '<tr><td>' . ucwords(str_replace('_', ' ', $key)) . '<font color="#FF0033">*</font></td>    						<td><select name="'.$key.'" id="'.$key.'">';while($data=mysql_fetch_row($res)){if($value==$data[0])echo '<option value="'.$data[0].'" selected>'.$data[1].'</option>';elseecho '<option value="'.$data[0].'">'.$data[1].'</option>';}echo "  </select></td></tr>";}function get_info($id=0){			//echo $id;			if($id)			$res = db_lookup_id($this->table_name, $id);			else				$res==NULL;			if($res==NULL){			$this->flag="insert";			return $this->fields_empty;				}			else			return $res;		}function delete_row($table,$field,$value){	$sql="select * from $table where $field=$value limit 1";	$query=mysql_query($sql);	if(mysql_num_rows($query)==1)	{	if(mysql_query("delete from $table where $field=$value limit 1"))	{	return TRUE;	}	else	return NULL;	}	else	return NULL;	}		function update($id) {				$vars = get_vars($this->fields);			$vars['entry_by']=$_SESSION['user_name'];			$vars['entry_date'] =date("Y-m-d",time());						$vars['entry_date'] =date2mysql_format($vars['entry_date']);			$vars['edit_date'] =date2mysql_format($vars['edit_date']);			$vars['join_date'] =date2mysql_format($vars['join_date']);						if($_FILES['profile_pic']['name']!=''){			$pic_name=$_FILES['profile_pic']['name'];			$name=explode('.',$pic_name);			$v=$id.'.gif';			$path= "../image/".$this->table_name."/".$v;			copy($_FILES['profile_pic']['tmp_name'], $path);			}			if ( count($vars) > 0 ) {							db_update($this->table_name,$id,$vars);			}			return $id;			}function insert($id) {				$vars = get_vars($this->fields);			$vars['entry_by']=$_SESSION['user_name'];			$vars['entry_date'] =date("Y-m-d",time());						$vars['entry_date'] =date2mysql_format($vars['entry_date']);			$vars['edit_date'] =date2mysql_format($vars['edit_date']);			$vars['join_date'] =date2mysql_format($vars['join_date']);						if ( count($vars) > 0 ) {							$id=db_insert_l($this->table_name,$vars);			}			if($_FILES['profile_pic']['name']!=''){			$pic_name=$_FILES['profile_pic']['name'];			$name=explode('.',$pic_name);			$v=$id.'.gif';			$path= "../image/".$this->table_name."/".$v;			copy($_FILES['profile_pic']['tmp_name'], $path);			}			return $id;			}		function update_password(){			$id = "";			Global $auth;			$id = $_SESSION['patient_id'];			$res = db_lookup($this->table_name," id_patient=".$id." and binary password = '".$_POST['password']."'");			if($res==NULL){				$id=0;			}else{				db_execute("update patient set password = '".$_POST['confirm_new_pass']."' where id_patient=".$id);				$id = $id;			}			return $id;		}		function delete ($id) {			db_delete($this->table_name,$id);		}		function lookup ($user_name , $user_password = NULL) {			$result = NULL;			$restriction = " user_name = '".addslashes($user_name)."' ";			if ( $user_password != NULL ) {				$restriction = $restriction . " and user_password = '".addslashes($user_password)."'";			}			$result = db_lookup($this->table_name,$restriction);			return $result;		}				function lookup_id ($id) {			return db_lookup_id($this->table_name,$id);		}				function get_vercode($id) {			$row = $this->lookup_id($id);			return $row->vercode;		}				function verify ($id) {			db_execute("update $this->table_name set is_active =". ACTIVE_USER." where id_patient = $id");		}					function GetMonthString($n){		$timestamp = mktime(0, 0, 0, $n, 1, 2005);		return date("M", $timestamp);	}	}?>